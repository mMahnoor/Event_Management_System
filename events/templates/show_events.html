{% load static %}
{% load check_group_tag %}
<div class="relative bg-yellow-50 flex flex-col justify-center gap-4 items-center px-4 py-8">
    <div class="absolute -top-4 -left-4">
        <img src="{% static 'Images/m_garland.png' %}" class="w-[150px] h-auto -hue-rotate-30" alt="icon">
    </div>
    <div class="absolute -top-4 left-60 hidden sm:flex">
        <img src="{% static 'Images/m_garland.png' %}" class="w-[150px] h-auto -hue-rotate-30" alt="icon">
    </div>
    <div class="absolute -top-4 right-60 hidden sm:flex">
        <img src="{% static 'Images/m_garland.png' %}" class="w-[150px] h-auto -hue-rotate-30" alt="icon">
    </div>
    <div class="absolute -top-4 -right-4">
        <img src="{% static 'Images/m_garland.png' %}" class="w-[150px] h-auto -hue-rotate-30" alt="icon">
    </div>
    <div class="w-full xl:w-2/3 flex flex-row justify-center items-center p-4">
        {% if called_from == "home" %}
        {% url "home" as home_url %}
            {% include "Widget/general_search.html" with action_url=home_url %}
        {% else %}
            {% include "Widget/search_form.html" with action_url=action_url %}
        {% endif %}
    </div>
    <h1 class="text-2xl font-bold text-yellow-700 items-start block">{{title}}</h1>
    {% if participants %}
        {% comment %} Table {% endcomment %}
        <div class="w-full overflow-x-auto">{% include "Widget/table.html" with data=participants headers=participant_headers %}</div>
    {% else %}
        {% if messages %}
            {% include "Widget/Alerts.html" with messages=messages %}
        {% endif %}
        <div class="w-full flex flex-row flex-wrap gap-4 justify-center items-stretch sm:p-5">
            {% for event in events %}
                {% comment %} Card {% endcomment %}
                <div class="max-w-[300px] bg-white rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 flex flex-col">
                    {% comment %} Card-Header {% endcomment %}
                    <div class="bg-slate-400 w-full rounded-t-xl flex-1 flex items-center justify-center overflow-hidden">                        
                        <img src="{{ event.first_image.image.url | default:'/static/Images/default.png' }}" alt="{{ image }}" class="w-full h-full object-cover rounded-t-xl">
                    </div>
                    {% comment %} Card-Content {% endcomment %}
                    <div class="p-6 bg-[linear-gradient(135deg,#2C1B10,#523824)] rounded-b-xl flex flex-col flex-1 gap-4">
                        <h2 class="text-xl font-semibold text-yellow-50 mb-2">{{event.name}}</h2>
                        <p class="text-gray-400 text-sm mb-4 truncate">
                        {{event.description}}
                        </p>
                        <div class="flex flex-row gap-1 items-center uppercase text-sm text-yellow-400 font-semibold">
                            <div class="size-5 flex-shrink-0">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="#ba891e" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M480 160L352 160L352 288L480 288L480 160zM544 288L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 160C96 124.7 124.7 96 160 96L480 96C515.3 96 544 124.7 544 160L544 288zM160 352L160 480L288 480L288 352L160 352zM288 288L288 160L160 160L160 288L288 288zM352 352L352 480L480 480L480 352L352 352z"/></svg>
                            </div>
                            <span>{{event.category}}</span>
                        </div>
                        <div class="flex flex-row gap-1 items-center capitalize text-sm font-semibold text-gray-400">
                            <div class="size-5 flex-shrink-0">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="#ba891e" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M128 252.6C128 148.4 214 64 320 64C426 64 512 148.4 512 252.6C512 371.9 391.8 514.9 341.6 569.4C329.8 582.2 310.1 582.2 298.3 569.4C248.1 514.9 127.9 371.9 127.9 252.6zM320 320C355.3 320 384 291.3 384 256C384 220.7 355.3 192 320 192C284.7 192 256 220.7 256 256C256 291.3 284.7 320 320 320z"/></svg>
                            </div>
                            <span>{{event.location}}</span>
                        </div>
                        <div class="w-full flex flex-col sm:flex-row gap-1 text-sm font-semibold text-gray-400">
                            <div class="flex flex-row gap-1 items-center text-sm font-semibold">
                                <div class="size-5 flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" fill="#ba891e" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M224 64C241.7 64 256 78.3 256 96L256 128L384 128L384 96C384 78.3 398.3 64 416 64C433.7 64 448 78.3 448 96L448 128L480 128C515.3 128 544 156.7 544 192L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 192C96 156.7 124.7 128 160 128L192 128L192 96C192 78.3 206.3 64 224 64zM224 320C206.3 320 192 334.3 192 352L192 416C192 433.7 206.3 448 224 448L288 448C305.7 448 320 433.7 320 416L320 352C320 334.3 305.7 320 288 320L224 320z"/></svg></div>
                                {{event.event_date}}
                            </div>
                            <div class="flex flex-row gap-1 items-center text-sm font-semibold">
                                <div class="size-5 flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" fill="#ba891e" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64zM296 184L296 320C296 328 300 335.5 306.7 340L402.7 404C413.7 411.4 428.6 408.4 436 397.3C443.4 386.2 440.4 371.4 429.3 364L344 307.2L344 184C344 170.7 333.3 160 320 160C306.7 160 296 170.7 296 184z"/></svg></div>
                                {{event.event_time}}
                            </div>
                        </div>
                        {% comment %} Buttons {% endcomment %}
                        <div class="mt-auto">
                            {% if "Admin" in user_groups or "Organizer" in user_groups %}
                                <div class="flex items-center justify-between">
                                    <a href="{% url "event-detail" %}?id={{ event.id }}" class="px-4 py-2 border border-1 border-yellow-500 text-yellow-400 text-sm font-semibold rounded-lg hover:border-none hover:bg-yellow-500 hover:text-white transition-colors duration-300">
                                        Details
                                    </a>
                                    <div class="flex flex-row gap-2">
                                        <a href="{% url "update-event" event.id %}">
                                            <div class="size-5 hover:-translate-y-1 hover:duration-300">
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="#f0b73c" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M416.9 85.2L372 130.1L509.9 268L554.8 223.1C568.4 209.6 576 191.2 576 172C576 152.8 568.4 134.4 554.8 120.9L519.1 85.2C505.6 71.6 487.2 64 468 64C448.8 64 430.4 71.6 416.9 85.2zM338.1 164L122.9 379.1C112.2 389.8 104.4 403.2 100.3 417.8L64.9 545.6C62.6 553.9 64.9 562.9 71.1 569C77.3 575.1 86.2 577.5 94.5 575.2L222.3 539.7C236.9 535.6 250.2 527.9 261 517.1L476 301.9L338.1 164z"/></svg>
                                            </div>
                                        </a>
                                        <button type="button" class="size-5 hover:-translate-y-1 hover:duration-300" onclick="document.getElementById('{{ event.id }}').showModal()">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="#f0b73c" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M232.7 69.9C237.1 56.8 249.3 48 263.1 48L377 48C390.8 48 403 56.8 407.4 69.9L416 96L512 96C529.7 96 544 110.3 544 128C544 145.7 529.7 160 512 160L128 160C110.3 160 96 145.7 96 128C96 110.3 110.3 96 128 96L224 96L232.7 69.9zM128 208L512 208L512 512C512 547.3 483.3 576 448 576L192 576C156.7 576 128 547.3 128 512L128 208zM216 272C202.7 272 192 282.7 192 296L192 488C192 501.3 202.7 512 216 512C229.3 512 240 501.3 240 488L240 296C240 282.7 229.3 272 216 272zM320 272C306.7 272 296 282.7 296 296L296 488C296 501.3 306.7 512 320 512C333.3 512 344 501.3 344 488L344 296C344 282.7 333.3 272 320 272zM424 272C410.7 272 400 282.7 400 296L400 488C400 501.3 410.7 512 424 512C437.3 512 448 501.3 448 488L448 296C448 282.7 437.3 272 424 272z"/></svg>
                                        </button>
                                        {% url 'delete-event' event.id as deletion_url %}
                                        {% comment %} Dialog {% endcomment %}
                                        {% include "Widget/dialog.html" with delete_event_dialog=event.id deletion_url=deletion_url title='Warning!' message='Are you sure you want to delete this event? This action cannot be undone.' confirm_text='Delete' cancel_text='Cancel' %}
                                    </div> 
                                </div>
                            {% else %}
                                <form method="post" action="{% url "add-rsvp" %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="user" value="{{ request.user.id }}">
                                    <input type="hidden" name="event" value="{{ event.id }}">
                                    <button type="submit" class="px-4 py-2 border border-1 border-yellow-500 text-yellow-400 text-sm font-semibold rounded-lg hover:border-none hover:bg-yellow-500 hover:text-white transition-colors duration-300">
                                        RSVP
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
            {% if not events %}
                <div class="w-full col-span-full relative flex justify-center items-center">
                    <img class="opacity-40 w-[22rem]" src="{% static "Images/no_data.svg" %}" alt="">
                    <h2 class="absolute top-50 left-50 text-lg font-semibold text-gray-400">No events found!</h2>
                </div>
            {% endif %}
        </div>
    {% endif %}
</div>